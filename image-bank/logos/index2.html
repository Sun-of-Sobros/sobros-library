<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CHROMA Animation</title>
  <style>
    body {
      margin: 0;
      background-color: #000;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
      font-family: monospace;
    }
    canvas {
      position: absolute;
      z-index: 1;
    }
    #overlay {
      z-index: 2;
      text-align: center;
      font-size: 4em;
      opacity: 0.8;
      color: #FFFFFF;
      position: absolute;
    }
  </style>
</head>
<body>
  <canvas id="canvas"></canvas>
  <div id="overlay" style="opacity:0;">CHROMA</div>
  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const colours = [
      "#FF0000", "#00FF00", "#0000FF", "#FFFF00", "#FF00FF", "#00FFFF",
      "#FFA500", "#800080", "#FFC0CB", "#808080", "#00FF00", "#A52A2A",
      "#FFD700", "#C0C0C0", "#FFFFFF", "#000000"
    ];
    const targetText = "CHROMA";
    const pixelSize = 20;
    const gridWidth = Math.ceil(window.innerWidth / pixelSize);
    const gridHeight = Math.ceil(window.innerHeight / pixelSize);
    let animationInterval;

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    ctx.font = `${pixelSize}px monospace`;
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";

    const pixels = [];

    function initPixels() {
      for (let x = 0; x < gridWidth; x++) {
        for (let y = 0; y < gridHeight; y++) {
          const colour = randomColour();
          pixels.push({
            x: x * pixelSize,
            y: y * pixelSize,
            colour,
            targetColour: colour,
            flicker: true,
          });
        }
      }
    }

    function randomColour() {
      return colours[Math.floor(Math.random() * colours.length)];
    }

    function flickerPixels() {
      pixels.forEach((p) => {
        if (p.flicker) {
          p.colour = randomColour();
        }
      });
      drawPixels();
    }

    function drawPixels() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      pixels.forEach((p) => {
        ctx.fillStyle = p.colour;
        ctx.fillRect(p.x, p.y, pixelSize, pixelSize);
      });
    }

    function createTargetLogo() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "#FFFFFF";
      const lines = targetText.split(" ");
      lines.forEach((line, lineIndex) => {
        const x = canvas.width / 2;
        const y = canvas.height / 2 + (lineIndex * pixelSize * 1.5);
        for (let i = 0; i < line.length; i++) {
          const char = line[i];
          ctx.fillText(char, x + (i * pixelSize * 0.6), y);
        }
      });

      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
      pixels.forEach((p) => {
        const index = ((p.y + pixelSize / 2) * canvas.width + (p.x + pixelSize / 2)) * 4;
        if (imageData[index] === 255) {
          p.targetColour = "#000000";
          p.flicker = false;
        } else {
          p.targetColour = randomColour();
        }
      });
    }

    function movePixels() {
      let allSettled = true;
      pixels.forEach((p) => {
        if (p.colour !== p.targetColour) {
          p.colour = p.targetColour;
          allSettled = false;
        }
      });
      drawPixels();
      if (allSettled) {
        clearInterval(animationInterval);
        document.getElementById("overlay").style.opacity = 1;
      }
    }

    function startAnimation() {
      initPixels();
      drawPixels();
      animationInterval = setInterval(flickerPixels, 100);
      setTimeout(() => {
        createTargetLogo();
        clearInterval(animationInterval);
        animationInterval = setInterval(movePixels, 100);
      }, 3000);
    }

    startAnimation();
  </script>
</body>
</html>
