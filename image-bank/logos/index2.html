<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CHROMA Animation</title>
  <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@900&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      background-color: #000;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
      font-family: 'Raleway', sans-serif;
    }
    canvas {
      position: absolute;
      z-index: 1;
    }
    #overlay {
      z-index: 2;
      text-align: center;
      font-size: 6em;
      opacity: 0;
      position: absolute;
    }
  </style>
</head>
<body>
  <canvas id="canvas"></canvas>
  <div id="overlay">CHROMA</div>
  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const pixelSize = 50;
    const gridWidth = Math.ceil(window.innerWidth / pixelSize);
    const gridHeight = Math.ceil(window.innerHeight / pixelSize);
    const complementaryColours = {
      "#FF0000": "#00FFFF",
      "#00FF00": "#FF00FF",
      "#0000FF": "#FFFF00",
      "#FFFF00": "#0000FF",
      "#FF00FF": "#00FF00",
      "#00FFFF": "#FF0000",
      "#FFA500": "#800080",
      "#800080": "#FFA500",
      "#808080": "#FFFFFF",
      "#FFFFFF": "#808080",
      "#000000": "#FFFFFF"
    };
    const targetColours = Object.keys(complementaryColours);
    let targetColour = targetColours[Math.floor(Math.random() * targetColours.length)];
    let complementaryColour = complementaryColours[targetColour];
    let animationInterval;
    let allLocked = false;

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const pixels = [];

    function initPixels() {
      for (let x = 0; x < gridWidth; x++) {
        for (let y = 0; y < gridHeight; y++) {
          const colour = randomColour();
          pixels.push({
            x: x * pixelSize,
            y: y * pixelSize,
            colour,
            targetColour,
            flicker: true,
            locked: false
          });
        }
      }
    }

    function randomColour() {
      return targetColours[Math.floor(Math.random() * targetColours.length)];
    }

    function flickerPixels() {
      pixels.forEach((p) => {
        if (p.flicker) {
          p.colour = randomColour();
        } else if (!p.locked) {
          p.colour = p.targetColour;
        }
      });
      drawPixels();
    }

    function drawPixels() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      pixels.forEach((p) => {
        ctx.fillStyle = p.colour;
        ctx.fillRect(p.x, p.y, pixelSize, pixelSize);
      });
    }

    function lockPixelsToTarget() {
      let allSettled = true;
      pixels.forEach((p) => {
        if (p.colour === p.targetColour) {
          p.locked = true;
          p.flicker = false;
        } else {
          allSettled = false;
        }
      });
      drawPixels();
      if (allSettled) {
        clearInterval(animationInterval);
        createTargetLogo();
      }
    }

    function createTargetLogo() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = complementaryColour;
      const targetText = "CHROMA";
      ctx.font = "bold 100px 'Raleway', sans-serif";
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillText(targetText, canvas.width / 2, canvas.height / 2);

      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
      pixels.forEach((p) => {
        const index = ((p.y + pixelSize / 2) * canvas.width + (p.x + pixelSize / 2)) * 4;
        if (imageData[index] === 255) {
          p.targetColour = complementaryColour;
        } else {
          p.targetColour = targetColour;
        }
        p.flicker = false;
      });

      animationInterval = setInterval(lockPixelsToTarget, 50);
    }

    function startAnimation() {
      initPixels();
      drawPixels();
      animationInterval = setInterval(flickerPixels, 100);
      setTimeout(() => {
        clearInterval(animationInterval);
        animationInterval = setInterval(lockPixelsToTarget, 50);
      }, 2000);
    }

    document.getElementById("overlay").style.color = complementaryColour;
    startAnimation();
  </script>
</body>
</html>
